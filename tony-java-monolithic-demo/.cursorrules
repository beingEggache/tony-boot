# Web 项目开发规范

## 1. 项目概述

### 1.1 核心特点
- **模块化架构**：API、Service、DTO、DAO、PO 等分层设计。
- **Lombok 推荐**：DTO/PO 推荐使用 `@Getter @Setter`。
- **统一规范**：严格遵循本文档定义的开发规约。

### 1.2 占位符规范

| 占位符             | 说明          | 示例             |
|-----------------|-------------|----------------|
| `{company}`     | 公司/组织名（小写）  | `tony`         |
| `{projectName}` | 项目名（小写）     | `demo`         |
| `{ProjectName}` | 项目名（首字母大写）  | `Demo`         |
| `{module}`      | 模块名（小写）     | `sys`          |
| `{Module}`      | 模块名（首字母大写）  | `Sys`          |
| `{entity}`      | 实体类名（小写）    | `employee`     |
| `{Entity}`      | 实体类名（首字母大写） | `Employee`     |
| `{table}`       | 数据库表名（小写）   | `sys_employee` |

**包路径格式：** `{company}.{projectName}.{module}`。
**示例：** `tony.demo.sys.controller`。

---

## 2. 项目结构规范

### 2.1 标准模块结构
```
{project-name}/
├── {company}-api/              # Web 层：控制器、配置、启动类、Docker 文件
├── {company}-service/          # 业务层：服务实现、DAO、PO
├── {company}-dto/              # 数据传输：请求/响应/查询 DTO、枚举
├── {company}-sdk/              # 接口层：服务接口（可选）
├── db/                         # 数据库脚本
├── build.gradle.kts            # 根项目构建配置
├── settings.gradle.kts         # 项目设置文件
├── gradle.properties           # Gradle 属性配置
├── gradlew                     # Gradle Wrapper (Unix)
├── gradlew.bat                 # Gradle Wrapper (Windows)
├── gradle/                     # Gradle Wrapper 目录
├── README.md                   # 项目说明文档
├── .editorconfig               # 编辑器配置
├── .gitignore                  # Git 忽略文件
├── .gitattributes              # Git 属性配置
└── dockerBuild.sh              # Docker 构建脚本
```

### 2.2 包结构约定
- **API 模块：** `{company}.{projectName}.{module}.controller`。
- **Service 模块：** `{company}.{projectName}.{module}.service.impl`（实现）。
- **DTO 模块：** `{company}.{projectName}.{module}.dto.{req|resp|query|enums}`。
- **SDK 模块：** `{company}.{projectName}.{module}.service`（服务接口）。

### 2.3 核心文件结构

#### 2.3.1 API 模块文件
```
{company}-api/
├── src/main/
│   ├── java/{company}/{projectName}/
│   │   ├── {ProjectName}WebApp.java           # 主应用启动类
│   │   ├── config/                          # 配置类包
│   │   │   ├── {ProjectName}WebConfig.java    # Web 配置类
│   │   │   └── {ProjectName}WebContext.java   # Web 上下文常量（可选）
│   │   └── {module}/                        # 业务模块包
│   │       └── controller/                  # 控制器包
│   │           └── {Module}Controller.java    # 控制器类
│   └── resources/
│       ├── application.yml                  # 主配置文件
│       └── logback-spring.xml               # 日志配置
├── Dockerfile                               # Docker 镜像构建文件
├── docker-compose.yml                       # Docker 编排文件
├── docker-entrypoint.sh                     # Docker 启动脚本
└── build.gradle.kts                         # 模块构建配置
```

#### 2.3.2 Service 模块文件
```
{company}-service/
├── src/main/
│   ├── java/{company}/{projectName}/
│   │   └── {module}/                        # 业务模块包
│   │       ├── service/                     # 服务包
│   │       │   └── impl/                    # 服务实现包
│   │       │       └── {Module}Service.java   # 服务实现类
│   │       ├── dao/                         # 数据访问包
│   │       │   └── {Module}Dao.java           # 数据访问接口
│   │       └── po/                          # 持久化对象包
│   │           └── {Entity}.java              # 持久化对象类
│   └── resources/
│       └── mappers/                         # MyBatis 映射文件目录
│           └── {Module}Dao.xml              # SQL 映射文件
└── build.gradle.kts                         # 模块构建配置
```

#### 2.3.3 DTO 模块文件
```
{company}-dto/
├── src/main/
│   └── java/{company}/{projectName}/
│       └── {module}/                        # 业务模块包
│           └── dto/                         # DTO 包
│               ├── req/                     # 请求 DTO 包
│               │   └── {Entity}AddReq.java    # 请求 DTO 类
│               ├── resp/                    # 响应 DTO 包
│               │   └── {Entity}Resp.java      # 响应 DTO 类
│               ├── query/                   # 查询 DTO 包
│               │   └── {Entity}Query.java     # 查询 DTO 类
│               └── enums/                   # 枚举包
│                   └── {BusinessConcept}Enum.java # 枚举类
└── build.gradle.kts                         # 模块构建配置
```

#### 2.3.4 SDK 模块文件（可选）
```
{company}-sdk/
├── src/main/
│   └── java/{company}/{projectName}/
│       └── {module}/                        # 业务模块包
│           └── service/                     # 服务接口包
│               └── I{Module}Service.java      # 服务接口类
└── build.gradle.kts                         # 模块构建配置
```

#### 2.3.5 数据库脚本文件
```
db/
├── db.init.mysql.sql                        # 初始化用户、数据库（MySQL）
├── db.init.table.mysql.sql                  # 初始化表结构（MySQL）
└── db.init.data.mysql.sql                   # 初始化数据（MySQL）
```
---

## 3. 核心开发规范

### 3.1 注释规范
🔴 **必须**：所有 public 类、方法、属性必须有注释。

```java
/**
 * 功能描述
 * 详细说明/使用场景
 *
 * @param paramName 参数说明
 * @return 返回值说明
 * @throws ExceptionType 异常说明
 * @author 作者
 * @date 2025/07/04 14:00 （此处为生成时系统时间）
 */
```

### 3.2 导入规范
🔴 **必须**：禁止通配符导入，所有导入必须为显式导入。

```java
import java.util.UUID;
import org.springframework.util.AntPathMatcher;
// ❌ import java.util.*;  // 禁止
```

---

### 3.3 枚举规范
🔴 **必须**：所有枚举实现统一接口，支持默认值。

```java
@Schema(description = "状态枚举")
public enum StatusEnum implements IntEnumValue {
    ENABLED(1),
    DISABLED(0),
    @JsonEnumDefaultValue
    UNUSED(DEFAULT_INT_VALUE);

    private final int value;
    StatusEnum(int value) { this.value = value; }
    @Override public int getValue() { return value; }

    @JsonCreator
    public static StatusEnum create(int value) { /* ... */ }
}
```
```java
@Schema(description = "性别枚举")
public enum GenderEnum implements StringEnumValue {
    MALE("MALE"),
    FEMALE("FEMALE"),
    @JsonEnumDefaultValue
    UNUSED(DEFAULT_STRING_VALUE);

    private final String value;
    GenderEnum(String value) { this.value = value; }
    @Override public String getValue() { return value; }

    @JsonCreator
    public static GenderEnum create(String value) { /* ... */ }
}
```

🔴 **必须**：业务字段使用枚举类型，禁止使用原始类型。

```java
// ✅ 正确
public StatusEnum status = StatusEnum.ENABLED;
public GenderEnum gender = GenderEnum.MALE;

// ❌ 错误
public int status = 1;
public String status = "MALE";
```

---

## 4. 数据层规范

### 4.1 实体类规范
🔴 **必须**：使用 MyBatis-Plus 注解，包含审计字段。

🔴 **建议**：PO 类推荐使用 Lombok `@Getter @Setter`。

```java
@Getter
@Setter
@TableName("{table}")
public class {Entity} {
    @TableId
    private String {entity}Id;

    // 业务字段...

    @OrderBy
    @TableField(insertStrategy = FieldStrategy.NEVER, updateStrategy = FieldStrategy.NEVER)
    private LocalDateTime createTime = LocalDateTime.now();

    @MybatisPlusMetaProperty(MetaColumn.USER_ID)
    @TableField(fill = FieldFill.INSERT, updateStrategy = FieldStrategy.NEVER)
    private String creatorId = "";

    @MybatisPlusMetaProperty(MetaColumn.USER_NAME, relativeProp = "creatorId")
    @TableField(fill = FieldFill.INSERT, updateStrategy = FieldStrategy.NEVER)
    private String creatorName = "";

    @TableField(insertStrategy = FieldStrategy.NEVER, updateStrategy = FieldStrategy.NEVER, update = "CURRENT_TIMESTAMP")
    private LocalDateTime updateTime = LocalDateTime.now();

    @TableField(fill = FieldFill.UPDATE, insertStrategy = FieldStrategy.NEVER, updateStrategy = FieldStrategy.NEVER)
    private String updatorId = "";

    @TableField(fill = FieldFill.UPDATE, insertStrategy = FieldStrategy.NEVER, updateStrategy = FieldStrategy.NEVER)
    private String updatorName = "";

    @TableLogic
    private LocalDateTime deleteTime;

    @TableField(fill = FieldFill.INSERT, updateStrategy = FieldStrategy.NEVER)
    private String tenantId = "";
}
```

### 4.2 数据库表规范
🔴 **必须**：表名小写，下划线分隔，包含审计字段。

```sql
CREATE TABLE `{table}` (
    `{table}_id` varchar(50) NOT NULL COMMENT '主键',
    -- 业务字段...
    `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `creator_id` varchar(32) NOT NULL DEFAULT '' COMMENT '创建人',
    `creator_name` varchar(30) NOT NULL DEFAULT '' COMMENT '创建人名称',
    `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `updator_id` varchar(32) NOT NULL DEFAULT '' COMMENT '更新人',
    `updator_name` varchar(30) NOT NULL DEFAULT '' COMMENT '更新人名称',
    `delete_time` timestamp NULL DEFAULT NULL COMMENT '删除标记',
    `tenant_id` varchar(32) NOT NULL DEFAULT '' COMMENT '租户id',
    PRIMARY KEY (`{table}_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='{表说明}';
```

---

### 4.3 DAO 层规范
🔴 **必须**：继承 BaseDao，使用 XML 映射文件。

🔴 **禁止**：在接口上使用 @Select、@Update 等注解。

```java
public interface {Entity}Dao extends BaseDao<{Entity}> {
    List<{Entity}> findByCondition(String name, Integer status);
}
```

---

## 5. 业务层规范

### 5.1 DTO 规范
🔴 **必须**：请求/响应/查询 DTO 分离，使用校验注解。

**建议**：DTO 类推荐使用 Lombok `@Getter @Setter`。

```java
@Getter
@Setter
@Schema(description = "新增{Entity}请求")
public class {Entity}AddReq {
    @NotBlank(message = "姓名不能为空")
    @Schema(description = "姓名", example = "张三")
    private String name;

    @NotNull(message = "状态不能为空")
    @Schema(description = "状态")
    private StatusEnum status;
}
```
```java
@Getter
@Setter
@Schema(description = "员工{Entity}响应")
public class {Entity}Resp {
    @Schema(description = "ID")
    private String id;
    @Schema(description = "姓名")
    private String name;
    @Schema(description = "状态")
    private StatusEnum status;
}
```
```java
@Getter
@Setter
@Schema(description = "员工查询请求")
public class {Entity}Query {
    @Schema(description = "姓名（模糊查询）")
    private String name;
    @Schema(description = "状态")
    private StatusEnum status;
}
```

### 5.2 Service 层规范
**建议**：根据项目需要选择接口与实现分离。

🔴 **必须**：Bean 注入用 `@RequiredArgsConstructor` + `private final` 字段。

#### 5.2.1 有 SDK 层的情况

```java
// SDK 层接口
public interface I{Entity}Service {
    String add({Entity}AddReq req);
    {Entity}Resp detail(String id);
    PageResult<{Entity}Resp> query(PageQuery<{Entity}Query> req);
}
```
```java
// Service 层实现
@Service
@RequiredArgsConstructor
public class {Entity}Service implements I{Entity}Service {
    private final {Entity}Dao {entity}Dao;

    @Override
    public String add({Entity}AddReq req) { /* ... */ }

    @Override
    public EmployeeResp detail(String id) { /* ... */ }

    @Override
    public PageResult<{Entity}Resp> query(PageQuery<{Entity}Query> req) { /* ... */ }
}
```

#### 5.2.2 无 SDK 层的情况
```java
// 直接在 Service 层实现
@Service
@RequiredArgsConstructor
public class {Entity}Service {
    private final {Entity}Dao {entity}Dao;

    public String add({Entity}AddReq req) { /* ... */ }

    public EmployeeResp detail(String id) { /* ... */ }

    public PageResult<{Entity}Resp> query(PageQuery<{Entity}Query> req) { /* ... */ }
}
```

**禁止**：Service 实现类继承 MyBatis-Plus 的 `ServiceImpl`。

### 5.3 Controller 规范
🔴 **必须**：使用 `@RestController`，路由注解只放在方法上。

🔴 **必须**：统一使用 `@PostMapping` + `@RequestBody`。

🔴 **必须**： 方法参数校验统一使用 `@Validated`。

🔴 **必须**：Bean 注入用 `@RequiredArgsConstructor` + `private final` 字段。

```java
@RestController
@Tag(name = "{Entity}管理", description = "{Entity}相关接口")
@RequiredArgsConstructor
public class {Entity}Controller {
    private final {Entity}Service {entity}Service;

    @PostMapping("/add")
    @Operation(summary = "新增{entity}", description = "新增{entity}信息")
    public String add(@Validated @RequestBody {Entity}AddReq req) {
        return employeeService.add(req);
    }

    @PostMapping("/detail")
    @Operation(summary = "根据ID查询", description = "根据ID查询{entity}详情")
    public {Entity}Resp detail(@Validated @RequestBody IdReq req) {
        return {entity}Service.detail(req.getId());
    }

    @PostMapping("/query")
    @Operation(summary = "查询{entity}列表", description = "分页查询{etity}列表")
    public PageResult<{Entity}Resp> query(@Validated @RequestBody PageQuery<{Entity}Query> req) {
        return {entity}Service.query(req);
    }
}
```

---

## 6. 配置规范

### 6.1 Web 配置
**建议**：注册上下文注入器，支持 DTO 字段自动注入。

```java
@Configuration
public class {ProjectName}WebConfig {
    @Bean
    public UserIdInjector userIdInjector() {
        return new UserIdInjector();
    }
}
```

### 6.2 自定义注入注解
**建议**：封装自定义注解，避免手写字符串 key。

```java
@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
@JacksonInject("userId")
public @interface UserIdInject { }
```

---

## 7. 快速参考

### 7.1 规则优先级
- 🔴 **必须**：违反将导致编译错误或运行时异常。
- **建议**：推荐遵循，提高代码质量。
- 🟢 **可选**：根据项目需要选择。

### 7.2 核心规则速查表

| 层级             | 类名格式                                            | 包路径                              | 职责与要求                       |
|----------------|-------------------------------------------------|----------------------------------|-----------------------------|
| Controller     | `{Module}Controller`                            | `controller`                     | 接收请求、参数校验、调用Service、返回结果    |
| Service        | `{Module}Service`                               | `service.impl`                   | 业务逻辑实现、构造器注入、不继承ServiceImpl |
| Service接口(SDK) | `I{Module}Service`                              | `service`                        | 业务接口定义、无注解                  |
| DAO            | `{Module}Dao`                                   | `dao`                            | 数据访问、继承BaseDao、使用XML映射      |
| PO             | `{Entity}`                                      | `po`                             | 实体映射、MyBatis-Plus注解、审计字段    |
| DTO            | `{Entity}AddReq`/`{Entity}Resp`/`{Entity}Query` | `dto.req`/`dto.resp`/`dto.query` | 数据传输、校验注解、Swagger文档         |

### 7.3 常见错误模式
- ❌ 在 DAO 接口使用 `@Select` 注解。
- ❌ Controller 类上使用路由注解。
- ❌ 使用通配符导入。
- ❌ 实体类字段使用原始类型而非枚举。
- ❌ 缺少必要的注释。
- ❌ 违反命名规范。
- ❌ Bean 注入未用 @RequiredArgsConstructor + private final。

### 7.4 最佳实践清单
- ✅ 推荐使用 Lombok。
- ✅ Bean 注入用 @RequiredArgsConstructor + private final。
- ✅ 完整的参数校验。
- ✅ 规范的 Swagger 注解。
- ✅ 类型安全的 DTO 设计。
- ✅ 清晰的业务逻辑分层。
- ✅ 完整的项目骨架文件。

