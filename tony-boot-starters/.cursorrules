# tony-boot-starters é¡¹ç›®å¼€å‘è§„èŒƒ

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 æ ¸å¿ƒç‰¹ç‚¹
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šç‹¬ç«‹ã€æŒ‰éœ€é›†æˆã€‚
- **Kotlin ä¼˜å…ˆ**ï¼šä¸»è¦ä½¿ç”¨ Kotlinï¼Œå…¼å®¹ Javaã€‚
- **Explicit API**ï¼šä¸¥æ ¼éµå¾ª Kotlin Explicit API æ ‡å‡†ã€‚
- **ç»Ÿä¸€è§„èŒƒ**ï¼šä¸¥æ ¼éµå¾ªæœ¬æ–‡æ¡£å®šä¹‰çš„å¼€å‘è§„çº¦ã€‚

### 1.2 Explicit API æ ‡å‡†
ğŸ”´ **å¿…é¡»**ï¼šéµå¾ª Kotlin Explicit API æ ‡å‡†ã€‚

```kotlin
// âœ… æ­£ç¡® - æ˜¾å¼å£°æ˜ public å’Œè¿”å›ç±»å‹
public fun sendMessage(req: MessageSendReq): MessageSendResp {
    return MessageSendResp("msg_1", true)
}

public val appId: String = "test-app-id"

public data class MessageSendReq(
    public val receiveId: String,
    public val content: String,
)

// âŒ é”™è¯¯ - çœç•¥ public ä¿®é¥°ç¬¦æˆ–è¿”å›ç±»å‹
fun sendMessage(req: MessageSendReq) {  // ç¼ºå°‘ public å’Œè¿”å›ç±»å‹
    return MessageSendResp("msg_1", true)
}

val appId = "test-app-id"  // ç¼ºå°‘ public å’Œç±»å‹å£°æ˜

data class MessageSendReq(  // ç¼ºå°‘ public
    val receiveId: String,  // ç¼ºå°‘ public
    val content: String,    // ç¼ºå°‘ public
)
```

**è§„åˆ™è¯´æ˜ï¼š**
- æ‰€æœ‰ public ç±»ã€æ–¹æ³•ã€å±æ€§å¿…é¡»æ˜¾å¼å£°æ˜ `public` ä¿®é¥°ç¬¦ã€‚
- æ‰€æœ‰æ–¹æ³•é™¤è¿”å› Unit å¤–ï¼Œå¿…é¡»æ˜¾å¼å£°æ˜è¿”å›ç±»å‹ã€‚
- å†…éƒ¨ä½¿ç”¨çš„ private æˆå‘˜å¯ä»¥çœç•¥ç±»å‹å£°æ˜ã€‚

### 1.3 å ä½ç¬¦è§„èŒƒ

| å ä½ç¬¦              | è¯´æ˜              | ç¤ºä¾‹                    |
|------------------|-----------------|-----------------------|
| `{module}`       | æ¨¡å—åï¼ˆå°å†™ï¼Œä¸­åˆ’çº¿åˆ†éš”ï¼‰   | `redis`ã€`web-support` |
| `{Module}`       | æ¨¡å—åï¼ˆPascalCaseï¼‰ | `Redis`ã€`WebSupport`  |
| `{package-name}` | åŒ…åï¼ˆæ¨¡å—åå»ä¸­åˆ’çº¿ï¼‰     | `redis`ã€`websupport`  |

---

## 2. æ¨¡å—ç»“æ„è§„èŒƒ

### 2.1 æ ‡å‡†æ¨¡å—ç»“æ„
ğŸ”´ **å¿…é¡»**ï¼šæ¯ä¸ª starter æ¨¡å—é‡‡ç”¨å¦‚ä¸‹æ ‡å‡†ç»“æ„ã€‚

```
tony-{module}/
â”œâ”€â”€ build.gradle.kts                   # æ¨¡å—ç‹¬ç«‹æ„å»ºè„šæœ¬
â”œâ”€â”€ README.md                          # æ¨¡å—è¯¦ç»†è¯´æ˜æ–‡æ¡£
â””â”€â”€ src/
    â”œâ”€â”€ main/
    â”‚   â”œâ”€â”€ kotlin/
    â”‚   â”‚   â””â”€â”€ tony/{package-name}/    # æ¨¡å—ä¸»åŒ…
    â”‚   â”‚       â”œâ”€â”€ config/             # é…ç½®åŒ…
    â”‚   â”‚       â”‚   â”œâ”€â”€ {Module}Config.kt
    â”‚   â”‚       â”‚   â””â”€â”€ {Module}Properties.kt
    â”‚   â”‚       â”œâ”€â”€ utils/              # å·¥å…·ç±»åŒ…ï¼ˆå¯é€‰ï¼‰
    â”‚   â”‚       â”œâ”€â”€ exception/          # å¼‚å¸¸ç±»åŒ…ï¼ˆå¯é€‰ï¼‰
    â”‚   â”‚       â””â”€â”€ [å…¶ä»–åŒ…].../         # å…¶ä»–åŒ…ï¼ˆå¯é€‰ï¼‰
    â”‚   â”œâ”€â”€ java/                       # Java æºç ï¼ˆå¯é€‰ï¼‰
    â”‚   â””â”€â”€ resources/
    â”‚       â”œâ”€â”€ META-INF/
    â”‚       â”‚   â””â”€â”€ spring/
    â”‚       â”‚       â””â”€â”€ org.springframework.boot.autoconfigure.AutoConfiguration.imports
    â”‚       â””â”€â”€ {module}.config.yml     # é…ç½®ç¤ºä¾‹ï¼ˆå¯é€‰ï¼‰
    â””â”€â”€ test/
        â”œâ”€â”€ kotlin/
        â”‚   â””â”€â”€ tony/test/{package-name}/  # æ¨¡å—æµ‹è¯•åŒ…
        â”‚       â”œâ”€â”€ {ClassName}Test.kt     # å•å…ƒæµ‹è¯•
        â”‚       â”œâ”€â”€ config/                # æµ‹è¯•é…ç½®åŒ…ï¼ˆå¯é€‰ï¼‰
        â”‚       â”œâ”€â”€ {Module}BaseTest.kt    # åŸºç¡€æµ‹è¯•ç±»ï¼ˆå¯é€‰ï¼‰
        â”‚       â””â”€â”€ {Module}TestApplication.kt # æµ‹è¯•å¯åŠ¨ç±»ï¼ˆå¯é€‰ï¼‰
        â”œâ”€â”€ java/                          # Java æµ‹è¯•æºç ï¼ˆå¯é€‰ï¼‰
        â””â”€â”€ resources/                     # æµ‹è¯•èµ„æº
```

### 2.2 åŒ…ç»“æ„çº¦å®š
- **ä¸»åŒ…è·¯å¾„**ï¼š`tony.{package-name}`
- **é…ç½®åŒ…**ï¼š`tony.{package-name}.config`
- **å·¥å…·åŒ…**ï¼š`tony.{package-name}.utils`
- **å¼‚å¸¸åŒ…**ï¼š`tony.{package-name}.exception`

---

## 3. æ ¸å¿ƒå¼€å‘è§„èŒƒ

### 3.1 æ³¨é‡Šè§„èŒƒ
ğŸ”´ **å¿…é¡»**ï¼šæ‰€æœ‰å…¬å…±ç±»ã€æ–¹æ³•ã€å±æ€§å¿…é¡»æœ‰æ³¨é‡Šã€‚

```kotlin
/**
 * åŠŸèƒ½æè¿°
 *
 * è¯¦ç»†è¯´æ˜/ä½¿ç”¨åœºæ™¯
 *
 * @param [paramName] å‚æ•°è¯´æ˜
 * @return [ReturnType] è¿”å›å€¼è¯´æ˜
 * @throws [ExceptionType] å¼‚å¸¸è¯´æ˜
 * @author ä½œè€…
 * @date 2025/07/04 14:00 ï¼ˆæ­¤å¤„ä¸ºç”Ÿæˆæ—¶ç³»ç»Ÿæ—¶é—´ï¼‰
 */
```

### 3.2 å¯¼å…¥è§„èŒƒ
ğŸ”´ **å¿…é¡»**ï¼šç¦æ­¢é€šé…ç¬¦å¯¼å…¥ï¼Œæ˜¾å¼å¯¼å…¥æ‰€æœ‰ä¾èµ–ã€‚

```kotlin
import java.util.UUID
import org.springframework.util.AntPathMatcher
// âŒ import java.util.*  // ç¦æ­¢
```

### 3.3 æšä¸¾è§„èŒƒ
ğŸ”´ **å¿…é¡»**ï¼šæ‰€æœ‰æšä¸¾å®ç°ç»Ÿä¸€æ¥å£ï¼Œæ”¯æŒé»˜è®¤å€¼ã€‚

```kotlin
// Int ç±»å‹æšä¸¾
@Schema(description = "çŠ¶æ€æšä¸¾")
public enum class StatusEnum(public override val value: Int) : IntEnumValue {
    ENABLED(1),
    DISABLED(0),

    @JsonEnumDefaultValue
    UNUSED(DEFAULT_INT_VALUE);

    public companion object : IntEnumCreator(StatusEnum::class.java) {
        @JsonCreator
        @JvmStatic
        public override fun create(value: Int): StatusEnum = super.create(value)
    }
}

// String ç±»å‹æšä¸¾
@Schema(description = "ç¼–ç æšä¸¾")
public enum class EncodingEnum(public override val value: String) : StringEnumValue {
    HEX("HEX"),
    BASE64("BASE64"),

    @JsonEnumDefaultValue
    UNUSED(DEFAULT_STRING_VALUE);

    public companion object : StringEnumCreator(EncodingEnum::class.java) {
        @JsonCreator
        @JvmStatic
        public override fun create(value: String): EncodingEnum = super.create(value)
    }
}
```

ğŸ”´ **å¿…é¡»**ï¼šä¸šåŠ¡å­—æ®µä½¿ç”¨æšä¸¾ç±»å‹ï¼Œç¦æ­¢ä½¿ç”¨åŸå§‹ç±»å‹ã€‚

```kotlin
// âœ… æ­£ç¡®
public var status: StatusEnum = StatusEnum.ENABLED
public var encoding: EncodingEnum = EncodingEnum.HEX

// âŒ é”™è¯¯
public var status: Int = 1
public var encoding: String = "HEX"
```

### 3.4 Java äº’æ“ä½œè§„èŒƒ
ğŸ”´ **å¿…é¡»**ï¼šå·¥å…·ç±»ä½¿ç”¨ `@file:JvmName` æä¾› Java å‹å¥½ç±»åã€‚

ğŸ”´ **å¿…é¡»**ï¼šå…³é”® API ä½¿ç”¨ `@JvmStatic`ã€`@JvmOverloads`ã€‚

```kotlin
@file:JvmName("Strs")
public object Strs {
    @JvmStatic
    public fun isBlank(str: String?): Boolean = str == null || str.isBlank()

    @JvmStatic
    @JvmOverloads
    public fun truncate(str: String, maxLength: Int = 100): String {
        return if (str.length <= maxLength) str else str.substring(0, maxLength)
    }
}
```

### 3.5 å¼‚å¸¸å¤„ç†è§„èŒƒ
ğŸ”´ **å¿…é¡»**ï¼šä¼˜å…ˆä½¿ç”¨å·¥å…·å‡½æ•°æŠ›å‡ºå¼‚å¸¸ã€‚

ğŸ”´ **å¿…é¡»**ï¼šæ‰€æœ‰è‡ªå®šä¹‰å¼‚å¸¸ç»§æ‰¿ tony.exception.ApiExceptionã€‚

```kotlin
// å·¥å…·å‡½æ•°ç¤ºä¾‹
value.throwIfNull("å€¼ä¸èƒ½ä¸ºç©º")
condition.throwIfTrue("æ¡ä»¶ä¸æ»¡è¶³")
```

---

## 4. è‡ªåŠ¨è£…é…è§„èŒƒ

### 4.1 é…ç½®ç±»è§„èŒƒ
ğŸ”´ **å¿…é¡»**ï¼šæ³¨å†Œåˆ° `META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports`ã€‚

```kotlin
@Configuration
@EnableConfigurationProperties({Module}Properties::class)
@ConditionalOnProperty(prefix = "tony.{module}", name = ["enabled"], havingValue = "true", matchIfMissing = true)
public class {Module}Config(public val properties: {Module}Properties) {

    @ConditionalOnMissingBean({Module}Service::class)
    @Bean
    public fun {module}Service(): {Module}Service {
        return {Module}Service(properties)
    }
}
```

### 4.2 é…ç½®å±æ€§è§„èŒƒ
ğŸ”´ **å¿…é¡»**ï¼šä½¿ç”¨ `@ConfigurationProperties` æ³¨è§£ã€‚

```kotlin
@ConfigurationProperties(prefix = "tony.{module}")
public data class {Module}Properties(
    public val enabled: Boolean = true,
    public val name: String = "default",
    public val timeout: Duration = Duration.ofSeconds(30),
)
```

### 4.3 ç»Ÿä¸€å…¥å£æ³¨è§£
ğŸ”´ **å¿…é¡»**ï¼šä½¿ç”¨ `@EnableTonyBoot` ä½œä¸ºç»Ÿä¸€å…¥å£ã€‚

```kotlin
@EnableTonyBoot
@SpringBootApplication
public class YourApplication
```

---

## 5. æµ‹è¯•è§„èŒƒ

### 5.1 æµ‹è¯•ç±»ç»„ç»‡è§„èŒƒ

```kotlin
@DisplayName("æµ‹è¯•ç±»åç§°")
class {ClassName}Test {

    @Nested
    @DisplayName("åŠŸèƒ½æ¨¡å—æµ‹è¯•")
    inner class {Feature}Test {
        @Test
        @DisplayName("å…·ä½“æµ‹è¯•åœºæ™¯")
        fun test{Scenario}() {
            // æµ‹è¯•é€»è¾‘
        }
    }
}
```

### 5.2 æµ‹è¯•æ–¹æ³•è§„èŒƒ
ğŸ”´ **å¿…é¡»**ï¼šæ‰€æœ‰æµ‹è¯•æ–­è¨€ä½¿ç”¨ org.junit.jupiter.api åŒ…ä¸‹çš„æ–¹æ³•ã€‚

```kotlin
@Test
@DisplayName("æ–¹æ³•å():æµ‹è¯•åœºæ™¯æè¿°")
fun test{MethodName}{Scenario}() {
    // æµ‹è¯•é€»è¾‘
}
```

### 5.3 é›†æˆæµ‹è¯•è§„èŒƒ
ğŸ”´ **å¿…é¡»**ï¼šä½¿ç”¨ `@SpringBootTest` å’Œ `@EnableTonyBoot`ã€‚

```kotlin
@SpringBootTest(
    classes = [{Module}TestApplication::class],
    webEnvironment = SpringBootTest.WebEnvironment.NONE
)
@ActiveProfiles("qa")
@TestPropertySource(locations = ["classpath:application.yml"])
@TestInstance(TestInstance.Lifecycle.PER_CLASS)
abstract class {Module}BaseTest {
    // åŸºç¡€æµ‹è¯•æ–¹æ³•
}

@SpringBootApplication
@EnableTonyBoot
@Import({Module}TestConfig::class)
class {Module}TestApplication
```

---

## 6. æ–‡æ¡£è§„èŒƒ

### 6.1 README.md ç»“æ„æ¨¡æ¿
ğŸ”´ **å¿…é¡»**ï¼šæ¯ä¸ªæ¨¡å—çš„ README.md éµå¾ªç»Ÿä¸€ç»“æ„ã€‚

````markdown
## æ¦‚è¿°

`tony-{module}` æ˜¯ `tony-boot-starters` ä½“ç³»ä¸‹çš„ {åŠŸèƒ½æè¿°} æ¨¡å—ï¼Œ{æ ¸å¿ƒä»·å€¼æè¿°}ã€‚

## å¦‚ä½•ä½¿ç”¨

### ç¯å¢ƒè¦æ±‚
- **Java 21** æˆ–æ›´é«˜ç‰ˆæœ¬
- **Spring Boot 3.x**

### æ·»åŠ ä¾èµ–
```kotlin
dependencies {
    implementation("tony:tony-{module}:0.1-SNAPSHOT")
}
```

### å¯ç”¨æ¨¡å—
```kotlin
@EnableTonyBoot
@SpringBootApplication
public class YourApplication
```

## ä¸»è¦åŠŸèƒ½
- åŠŸèƒ½ç‚¹1
- åŠŸèƒ½ç‚¹2

## é…ç½®è¯´æ˜
| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ | å¿…å¡« |
|--------|------|--------|------|
| tony.{module}.enabled | æ˜¯å¦å¯ç”¨ | true | å¦ |

## ä½¿ç”¨ç¤ºä¾‹
### åŸºç¡€ç”¨æ³•
```kotlin
// ä½¿ç”¨ç¤ºä¾‹ä»£ç 
```

## æ³¨æ„äº‹é¡¹
- æ³¨æ„äº‹é¡¹1
- æ³¨æ„äº‹é¡¹2
````

---

## 7. å¿«é€Ÿå‚è€ƒ

### 7.1 è§„åˆ™ä¼˜å…ˆçº§
- ğŸ”´ **å¿…é¡»**ï¼šè¿åå°†å¯¼è‡´ç¼–è¯‘é”™è¯¯æˆ–è¿è¡Œæ—¶å¼‚å¸¸ã€‚

- **å»ºè®®**ï¼šæ¨èéµå¾ªï¼Œæé«˜ä»£ç è´¨é‡ã€‚

- ğŸŸ¢ **å¯é€‰**ï¼šæ ¹æ®é¡¹ç›®éœ€è¦é€‰æ‹©ã€‚

### 7.2 æ ¸å¿ƒè§„åˆ™é€ŸæŸ¥è¡¨

| å±‚çº§   | ç±»åæ ¼å¼                 | åŒ…è·¯å¾„         | èŒè´£ä¸è¦æ±‚                     |
|------|----------------------|-------------|---------------------------|
| é…ç½®ç±»  | `{Module}Config`     | `config`    | è‡ªåŠ¨è£…é…é…ç½®ã€æ¡ä»¶æ³¨è§£ã€Beanæ³¨å†Œ        |
| é…ç½®å±æ€§ | `{Module}Properties` | `config`    | é…ç½®å±æ€§å®šä¹‰ã€é»˜è®¤å€¼è®¾ç½®              |
| å¼‚å¸¸ç±»  | `{Module}Exception`  | `exception` | è‡ªå®šä¹‰å¼‚å¸¸ã€ç»§æ‰¿ApiException      |
| æµ‹è¯•ç±»  | `{ClassName}Test`    | `test`      | å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€Given-When-Then |

### 7.3 å¸¸è§é”™è¯¯æ¨¡å¼
- âŒ çœç•¥ public ä¿®é¥°ç¬¦ã€‚
- âŒ çœç•¥æ–¹æ³•è¿”å›ç±»å‹ï¼ˆé™¤ Unit å¤–ï¼‰ã€‚
- âŒ çœç•¥å±æ€§ç±»å‹å£°æ˜ã€‚
- âŒ æœªæ³¨å†Œåˆ° AutoConfiguration.importsã€‚
- âŒ å·¥å…·ç±»æœªæä¾› Java å‹å¥½æ€§ã€‚
- âŒ æšä¸¾å­—æ®µä½¿ç”¨åŸå§‹ç±»å‹ã€‚
- âŒ ä½¿ç”¨é€šé…ç¬¦å¯¼å…¥ã€‚
- âŒ ç¼ºå°‘å¿…è¦çš„æ³¨é‡Šã€‚

### 7.4 æœ€ä½³å®è·µæ¸…å•
- âœ… ä¸¥æ ¼éµå¾ª Explicit API æ ‡å‡†ã€‚
- âœ… æ¨¡å—åŒ–è®¾è®¡ï¼Œç‹¬ç«‹é›†æˆã€‚
- âœ… å®Œæ•´çš„è‡ªåŠ¨è£…é…é…ç½®ã€‚
- âœ… Java äº’æ“ä½œå‹å¥½æ€§ã€‚
- âœ… å®Œæ•´çš„æµ‹è¯•è¦†ç›–ã€‚
- âœ… è§„èŒƒçš„æ–‡æ¡£ç»“æ„ã€‚
- âœ… ç±»å‹å®‰å…¨çš„æšä¸¾ä½¿ç”¨ã€‚
- âœ… æ¸…æ™°çš„åŒ…ç»“æ„ç»„ç»‡ã€‚
