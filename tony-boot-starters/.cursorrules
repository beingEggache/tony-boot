# tony-boot-starters é¡¹ç›®å¼€å‘è§„èŒƒ

---
## è§„åˆ™ç­‰çº§è¯´æ˜
- ğŸ”´ **å¿…é¡»**ï¼šé¡¹ç›®å¼ºåˆ¶è¦æ±‚ã€‚
- ğŸŸ¡ **å»ºè®®**ï¼šæ¨èéµå¾ªï¼Œæé«˜ä»£ç è´¨é‡ã€‚
- ğŸŸ¢ **å¯é€‰**ï¼šæ ¹æ®é¡¹ç›®éœ€è¦é€‰æ‹©ã€‚
---

## 1. é¡¹ç›®æ¦‚è¿°

---
### æ ¸å¿ƒç‰¹ç‚¹
- **Kotlin ä¼˜å…ˆ**ï¼šä¸»è¦ä½¿ç”¨ Kotlinï¼Œå…¼å®¹ Javaã€‚
- **ç»Ÿä¸€è§„èŒƒ**ï¼šä¸¥æ ¼éµå¾ªæœ¬æ–‡æ¡£å®šä¹‰çš„å¼€å‘è§„çº¦ã€‚
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šç‹¬ç«‹ã€æŒ‰éœ€é›†æˆã€‚
---
### å ä½ç¬¦è§„èŒƒ

| å ä½ç¬¦              | è¯´æ˜              | ç¤ºä¾‹                    |
|------------------|-----------------|-----------------------|
| `{module}`       | æ¨¡å—åï¼ˆå°å†™ï¼Œä¸­åˆ’çº¿åˆ†éš”ï¼‰   | `redis`ã€`web-support` |
| `{Module}`       | æ¨¡å—åï¼ˆPascalCaseï¼‰ | `Redis`ã€`WebSupport`  |
| `{package-name}` | åŒ…åï¼ˆæ¨¡å—åå»ä¸­åˆ’çº¿ï¼‰     | `redis`ã€`websupport`  |
---

## 2. æ¨¡å—ç»“æ„è§„èŒƒ

---
### æ ‡å‡†æ¨¡å—ç»“æ„
ğŸ”´ æ¯ä¸ª starter æ¨¡å—é‡‡ç”¨å¦‚ä¸‹æ ‡å‡†ç»“æ„ã€‚

```
tony-{module}/
â”œâ”€â”€ build.gradle.kts                   # æ¨¡å—ç‹¬ç«‹æ„å»ºè„šæœ¬
â”œâ”€â”€ README.md                          # æ¨¡å—è¯¦ç»†è¯´æ˜æ–‡æ¡£
â””â”€â”€ src/
    â”œâ”€â”€ main/
    â”‚   â”œâ”€â”€ kotlin/
    â”‚   â”‚   â””â”€â”€ tony/{package-name}/          # æ¨¡å—ä¸»åŒ…
    â”‚   â”‚       â”œâ”€â”€ config/                   # é…ç½®åŒ…
    â”‚   â”‚       â”‚   â”œâ”€â”€ {Module}Config.kt
    â”‚   â”‚       â”‚   â””â”€â”€ {Module}Properties.kt # é…ç½® ï¼ˆå¯é€‰ï¼‰
    â”‚   â”‚       â”œâ”€â”€ utils/                    # å·¥å…·ç±»åŒ…ï¼ˆå¯é€‰ï¼‰
    â”‚   â”‚       â”œâ”€â”€ exception/                # å¼‚å¸¸ç±»åŒ…ï¼ˆå¯é€‰ï¼‰
    â”‚   â”‚       â””â”€â”€ [å…¶ä»–åŒ…].../               # å…¶ä»–åŒ…ï¼ˆå¯é€‰ï¼‰
    â”‚   â”œâ”€â”€ java/                             # Java æºç ï¼ˆå¯é€‰ï¼‰
    â”‚   â””â”€â”€ resources/
    â”‚       â”œâ”€â”€ META-INF/
    â”‚       â”‚   â””â”€â”€ spring/
    â”‚       â”‚       â””â”€â”€ org.springframework.boot.autoconfigure.AutoConfiguration.imports
    â”‚       â””â”€â”€ {module}.config.yml     # é»˜è®¤é…ç½®ï¼ˆå¯é€‰ï¼‰
    â””â”€â”€ test/
        â”œâ”€â”€ kotlin/
        â”‚   â””â”€â”€ tony/test/{package-name}/      # æ¨¡å—æµ‹è¯•åŒ…
        â”‚       â”œâ”€â”€ {ClassName}Test.kt         # å•å…ƒæµ‹è¯•
        â”‚       â”œâ”€â”€ config/                    # æµ‹è¯•é…ç½®åŒ…ï¼ˆå¯é€‰ï¼‰
        â”‚       â”œâ”€â”€ {Module}BaseTest.kt        # åŸºç¡€æµ‹è¯•ç±»ï¼ˆå¯é€‰ï¼‰
        â”‚       â””â”€â”€ {Module}TestApplication.kt # æµ‹è¯•å¯åŠ¨ç±»ï¼ˆå¯é€‰ï¼‰
        â”œâ”€â”€ java/                              # Java æµ‹è¯•æºç ï¼ˆå¯é€‰ï¼‰
        â””â”€â”€ resources/                         # æµ‹è¯•èµ„æº
```
---
### æ„å»ºè„šæœ¬è§„èŒƒ
ğŸ”´ å­æ¨¡å—çš„ `build.gradle.kts` åªåŒ…å«ä¾èµ–å£°æ˜ï¼Œä¸åŒ…å«æ’ä»¶é…ç½®ã€‚

**æ ‡å‡†æ ¼å¼**ï¼š
```kotlin
dependencies {
    api(projects.tonyCore)
    implementation(tonyLibs.springBootStarterWeb)
    testImplementation(tonyLibs.springBootStarterTest)
}
```
ğŸ”´ **ç¦æ­¢**ï¼šå…¶ä»–ä»»ä½•é…ç½®ã€‚

---
### é»˜è®¤é…ç½®è§„èŒƒ
ğŸŸ¢ éœ€è¦è¦†ç›– Spring Boot æˆ–å…¶ä»– starter é»˜è®¤é…ç½®æ—¶ï¼Œåˆ›å»º `{module}.config.yml` å¹¶åœ¨ `{Module}Config` ç±»ä¸Šæ·»åŠ  `@PropertySource` æ³¨è§£ã€‚

**æ ‡å‡†æ ¼å¼**ï¼š
```kotlin
@PropertySource("classpath:{module}.config.yml", factory = YamlPropertySourceFactory::class) //å¯é€‰
@EnableConfigurationProperties({Module}Properties::class)
@Configuration
public class {Module}Config(public val properties: {Module}Properties) {
    // é…ç½®é€»è¾‘
}
```
---

## 3. æ ¸å¿ƒå¼€å‘è§„èŒƒ

---
### Explicit API æ ‡å‡†
ğŸ”´ æ‰€æœ‰ public ç±»ã€æ–¹æ³•ã€å±æ€§å¿…é¡»æ˜¾å¼å£°æ˜ `public` ä¿®é¥°ç¬¦å’Œè¿”å›ç±»å‹ã€‚

```kotlin
// âœ… æ­£ç¡®
public fun sendMessage(req: MessageSendReq): MessageSendResp {
    return MessageSendResp("msg_1", true)
}

public val appId: String = "test-app-id"

// âŒ é”™è¯¯
fun sendMessage(req: MessageSendReq) {  // ç¼ºå°‘ public å’Œè¿”å›ç±»å‹
    return MessageSendResp("msg_1", true)
}
```
---
### æ³¨é‡Šè§„èŒƒ
ğŸ”´ æ‰€æœ‰å…¬å…±ç±»ã€æ¥å£ã€æ–¹æ³•ã€å±æ€§ã€å˜é‡å¿…é¡»æœ‰æ³¨é‡Šã€‚

```kotlin
/**
 * åŠŸèƒ½æè¿°
 *
 * è¯¦ç»†è¯´æ˜/ä½¿ç”¨åœºæ™¯
 *
 * @param [paramName] å‚æ•°è¯´æ˜
 * @return [ReturnType] è¿”å›å€¼è¯´æ˜
 * @throws [ExceptionType] å¼‚å¸¸è¯´æ˜
 * @author ä½œè€…
 * @date 2025/07/04 14:00 ï¼ˆæ­¤å¤„ä¸ºç”Ÿæˆæ—¶ç³»ç»Ÿæ—¶é—´ï¼‰
 */
```
---
### å¯¼å…¥è§„èŒƒ
ğŸ”´ ç¦æ­¢é€šé…ç¬¦å¯¼å…¥ï¼Œæ˜¾å¼å¯¼å…¥æ‰€æœ‰ä¾èµ–ã€‚

```kotlin
import java.util.UUID
import org.springframework.util.AntPathMatcher
// âŒ import java.util.*  // ç¦æ­¢
```
---
### æšä¸¾è§„èŒƒ
ğŸ”´ æšä¸¾å€¼å‘½åå…¨å¤§å†™, æ‰€æœ‰æšä¸¾å®ç°ç»Ÿä¸€æ¥å£ï¼Œæ”¯æŒé»˜è®¤å€¼ã€‚

```kotlin
// Int ç±»å‹æšä¸¾
@Schema(description = "çŠ¶æ€æšä¸¾")
public enum class StatusEnum(public override val value: Int) : IntEnumValue {
    ENABLED(1),
    DISABLED(0),

    @JsonEnumDefaultValue
    UNUSED(DEFAULT_INT_VALUE);

    public companion object : IntEnumCreator(StatusEnum::class.java) {
        @JsonCreator
        @JvmStatic
        public override fun create(value: Int): StatusEnum = super.create(value)
    }
}

// String ç±»å‹æšä¸¾
@Schema(description = "ç¼–ç æšä¸¾")
public enum class EncodingEnum(public override val value: String) : StringEnumValue {
    HEX("HEX"),
    BASE64("BASE64"),

    @JsonEnumDefaultValue
    UNUSED(DEFAULT_STRING_VALUE);

    public companion object : StringEnumCreator(EncodingEnum::class.java) {
        @JsonCreator
        @JvmStatic
        public override fun create(value: String): EncodingEnum = super.create(value)
    }
}
```

ğŸ”´ ä¸šåŠ¡å­—æ®µä½¿ç”¨æšä¸¾ç±»å‹ï¼Œç¦æ­¢ä½¿ç”¨åŸå§‹ç±»å‹ã€‚

```kotlin
// âœ… æ­£ç¡®
public var status: StatusEnum = StatusEnum.ENABLED
public var encoding: EncodingEnum = EncodingEnum.HEX

// âŒ é”™è¯¯
public var status: Int = 1
public var encoding: String = "HEX"
```
---
### Java äº’æ“ä½œè§„èŒƒ
ğŸ”´ å·¥å…·ç±»ä½¿ç”¨ `@file:JvmName` æä¾› Java å‹å¥½ç±»å, å…³é”® API ä½¿ç”¨ `@JvmStatic`ã€`@JvmOverloads`ã€‚

```kotlin
@file:JvmName("Strs")
public object Strs {

    @JvmStatic
    @JvmOverloads
    public fun truncate(str: String, maxLength: Int = 100): String {
        return if (str.length <= maxLength) str else str.substring(0, maxLength)
    }
}
```
---
### å¼‚å¸¸å¤„ç†è§„èŒƒ
ğŸ”´ ä¼˜å…ˆä½¿ç”¨å·¥å…·å‡½æ•°æŠ›å‡ºå¼‚å¸¸, æ‰€æœ‰è‡ªå®šä¹‰å¼‚å¸¸ç»§æ‰¿ tony.exception.ApiExceptionã€‚

```kotlin
// å·¥å…·å‡½æ•°ç¤ºä¾‹
value.throwIfNull("å€¼ä¸èƒ½ä¸ºç©º")
condition.throwIfTrue("æ¡ä»¶ä¸æ»¡è¶³")
```
---

## 4. è‡ªåŠ¨è£…é…è§„èŒƒ

---
### é…ç½®ç±»åŠé…ç½®å±æ€§è§„èŒƒ
ğŸ”´ æ³¨å†Œåˆ° `AutoConfiguration.imports`, ä½¿ç”¨ `@EnableConfigurationProperties`ã€‚

ğŸŸ¢ `tony.{module}.enabled` å±æ€§ä¸ `@ConditionalOnProperty` é…åˆä½¿ç”¨ï¼Œæ§åˆ¶æ¨¡å—æ˜¯å¦å¯ç”¨ã€‚ä»…å¯¹å½±å“æ•´ä½“é€»è¾‘çš„æ¨¡å—ä½¿ç”¨ï¼Œå·¥å…·ç±»æ¨¡å—æ— éœ€é…ç½®ã€‚

```kotlin
@ConditionalOnProperty(prefix = "tony.{module}", name = ["enabled"], havingValue = "true", matchIfMissing = true)  // ğŸŸ¢ å½±å“æ•´ä½“é€»è¾‘æ—¶æ·»åŠ 
@EnableConfigurationProperties({Module}Properties::class) // ğŸŸ¢ å½“éœ€è¦é…ç½®é¡¹æ—¶æ·»åŠ .
@Configuration
public class {Module}Config(public val properties: {Module}Properties){
    // ...
}
```
ğŸŸ¢ å½“éœ€è¦é…ç½®é¡¹æ—¶æ·»åŠ .
```kotlin
@ConfigurationProperties(prefix = "tony.{module}")
public data class {Module}Properties(
    public val enabled: Boolean = true,  // ğŸŸ¢ å½±å“æ•´ä½“é€»è¾‘æ—¶æ·»åŠ 
    public val name: String = "default",
    public val timeout: Duration = Duration.ofSeconds(30),
)
```
---
### ç»Ÿä¸€å…¥å£æ³¨è§£
ğŸ”´ ä½¿ç”¨ `@EnableTonyBoot` ä½œä¸ºç»Ÿä¸€å…¥å£ã€‚

```kotlin
@EnableTonyBoot
@SpringBootApplication
public class YourApplication
```
---

## 5. æµ‹è¯•è§„èŒƒ

---
### æµ‹è¯•ç±»ç»„ç»‡è§„èŒƒ
ğŸ”´ æ‰€æœ‰æµ‹è¯•æ–­è¨€ä½¿ç”¨ org.junit.jupiter.api åŒ…ä¸‹çš„æ–¹æ³•ã€‚
```kotlin
@DisplayName("æµ‹è¯•ç±»åç§°")
class {ClassName}Test {

    @Nested
    @DisplayName("åŠŸèƒ½æ¨¡å—æµ‹è¯•")
    inner class {Feature}Test {
        @Test
        @DisplayName("æ–¹æ³•å():æµ‹è¯•åœºæ™¯æè¿°")
        fun test{Scenario}() {
            // æµ‹è¯•é€»è¾‘
        }
    }
}
```
---
### é›†æˆæµ‹è¯•è§„èŒƒ
ğŸ”´ ä½¿ç”¨ `@SpringBootTest` å’Œ `@EnableTonyBoot`ã€‚

```kotlin
@SpringBootTest(
    classes = [{Module}TestApplication::class],
    webEnvironment = SpringBootTest.WebEnvironment.NONE
)
@ActiveProfiles("qa")
@TestPropertySource(locations = ["classpath:application.yml"])
@TestInstance(TestInstance.Lifecycle.PER_CLASS)
abstract class {Module}BaseTest {
    // åŸºç¡€æµ‹è¯•æ–¹æ³•
}
```
```kotlin
@SpringBootApplication
@EnableTonyBoot
@Import({Module}TestConfig::class)
class {Module}TestApplication
```
---

## 6. æ–‡æ¡£è§„èŒƒ

---
### README.md ç»“æ„æ¨¡æ¿
ğŸ”´ æ¯ä¸ªæ¨¡å—çš„ README.md éµå¾ªç»Ÿä¸€ç»“æ„ã€‚

````markdown
## æ¦‚è¿°

`tony-{module}` æ˜¯ `tony-boot-starters` ä½“ç³»ä¸‹çš„ {åŠŸèƒ½æè¿°} æ¨¡å—ï¼Œ{æ ¸å¿ƒä»·å€¼æè¿°}ã€‚

## å¦‚ä½•ä½¿ç”¨

### æ·»åŠ ä¾èµ–
```kotlin
dependencies {
    implementation("tony:tony-{module}:0.1-SNAPSHOT")
}
```

### å¯ç”¨æ¨¡å—
```kotlin
@EnableTonyBoot
@SpringBootApplication
public class YourApplication
```

## ä¸»è¦åŠŸèƒ½
- åŠŸèƒ½ç‚¹1
- åŠŸèƒ½ç‚¹2

## é…ç½®è¯´æ˜

| é…ç½®é¡¹                   | è¯´æ˜  | é»˜è®¤å€¼     | å¿…å¡« |
|-----------------------|-----|---------|----|
| tony.{module}.option1 | é€‰é¡¹1 | true    | å¦  |
| tony.{module}.option2 | é€‰é¡¹2 | 1       | å¦  |
| tony.{module}.option3 | é€‰é¡¹3 | 'hello' | å¦  |

## ä½¿ç”¨ç¤ºä¾‹
### åŸºç¡€ç”¨æ³•
```kotlin
// ä½¿ç”¨ç¤ºä¾‹ä»£ç 
```
````
---

## 7. å¿«é€Ÿå‚è€ƒ
- âŒ çœç•¥ public ä¿®é¥°ç¬¦ã€‚
- âŒ çœç•¥æ–¹æ³•è¿”å›ç±»å‹ï¼ˆé™¤ Unit å¤–ï¼‰ã€‚
- âŒ çœç•¥å±æ€§ç±»å‹å£°æ˜ã€‚
- âŒ æœªæ³¨å†Œåˆ° AutoConfiguration.importsã€‚
- âŒ å·¥å…·ç±»æœªæä¾› Java å‹å¥½æ€§ã€‚
- âŒ æšä¸¾å­—æ®µä½¿ç”¨åŸå§‹ç±»å‹ã€‚
- âŒ ä½¿ç”¨é€šé…ç¬¦å¯¼å…¥ã€‚
- âœ… ä¸¥æ ¼éµå¾ª Explicit API æ ‡å‡†ã€‚
- âœ… æ¨¡å—åŒ–è®¾è®¡ï¼Œç‹¬ç«‹é›†æˆã€‚
- âœ… å®Œæ•´çš„è‡ªåŠ¨è£…é…é…ç½®ã€‚
- âœ… Java äº’æ“ä½œå‹å¥½æ€§ã€‚
- âœ… å®Œæ•´çš„æµ‹è¯•è¦†ç›–ã€‚
- âœ… è§„èŒƒçš„æ–‡æ¡£ç»“æ„ã€‚
- âœ… ç±»å‹å®‰å…¨çš„æšä¸¾ä½¿ç”¨ã€‚
- âœ… æ¸…æ™°çš„åŒ…ç»“æ„ç»„ç»‡ã€‚
